{% extends 'destinations/base.html' %}

{% block content %}
    <div id="destination-detail">
        <!-- Destination details will be loaded here by JavaScript -->
        <p>Loading destination details...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const destinationId = {{ destination_id }};
            
            fetch(/api/destinations/${destinationId}/)
                .then(response => response.json())
                .then(destination => {
                    const container = document.getElementById('destination-detail');
                    
                    let imagesHtml = '<div class="image-gallery">';
                    destination.images.forEach(image => {
                        imagesHtml += `
                            <div>
                                <img src="${image.image}" alt="Destination image">
                                <button onclick="deleteImage(${image.id})" class="btn" style="background: #e8491d; width: 100%;">Delete</button>
                            </div>
                        `;
                    });
                    imagesHtml += '</div>';
                    
                    const html = `
                        <div class="card">
                            <h2>${destination.place_name}</h2>
                            <p><strong>Location:</strong> ${destination.district}, ${destination.state}</p>
                            <p><strong>Weather:</strong> ${destination.weather}</p>
                            <p><strong>Description:</strong></p>
                            <p>${destination.description}</p>
                            
                            <h3>Images</h3>
                            ${imagesHtml}
                            
                            <div style="margin-top: 20px;">
                                <a href="/${destination.id}/update/" class="btn">Edit Destination</a>
                                <button onclick="deleteDestination(${destination.id})" class="btn" style="background: #e8491d;">Delete Destination</button>
                                <a href="/" class="btn">Back to List</a>
                            </div>
                        </div>
                    `;
                    
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('destination-detail').innerHTML = 
                        '<p>Error loading destination details. Please try again later.</p>';
                });
        });
        
        function deleteImage(imageId) {
            if (confirm('Are you sure you want to delete this image?')) {
                fetch(/api/images/${imageId}/, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': csrftoken,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Error deleting image');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting image');
                });
            }
        }
        
        function deleteDestination(destinationId) {
            if (confirm('Are you sure you want to delete this destination? This cannot be undone.')) {
                fetch(/api/destinations/${destinationId}/, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': csrftoken,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/';
                    } else {
                        alert('Error deleting destination');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting destination');
                });
            }
        }
    </script>
{% endblock %}